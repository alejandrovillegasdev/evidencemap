$(window).on("load",function(){$.getJSON("./src/data/csvData.json",function(t){$.getJSON("./src/data/filters.json",function(e){$.getJSON("./src/data/referenceData.json",function(l){let s="auto",o="auto";const a=["Title","Authors","Year","ParentTitle","Volume","Issue","Pages","URL","DOI"],n=[{attribute:{AttributeId:5413915,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"High quality primary studies",AttributeDescription:""},color:"#066738"},{attribute:{AttributeId:5413925,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"High quality secondary study",AttributeDescription:""},color:"#fab852"},{attribute:{AttributeId:5413935,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"Low and medium primary studies",AttributeDescription:""},color:"#ffa500"},{attribute:{AttributeId:5413936,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"Low and medium quality secondary study",AttributeDescription:""},color:"#ff0000"},{attribute:{AttributeId:5413937,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"Not available",AttributeDescription:""},color:"#bdc6cb"}],i="",c='<svg id="checked" fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',r='<svg id="unchecked" fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',d='<svg id="indeterminate" fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M0 0h24v24H0z" id="a"/></defs><clipPath id="b"><use overflow="visible" xlink:href="#a"/></clipPath><path clip-path="url(#b)" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"/></svg>',h='<svg id="checked" fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',u='<svg id="unchecked" fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',p='<svg class="btnRowCollapse" id="arrowUp" fill="#000000" width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',f='<svg class="btnRowCollapse" id="arrowDown" fill="#000000" width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/><path fill="none" d="M0 0h24v24H0V0z"/></svg>',g='<svg class="btnColCollapse" id="arrowLeft" fill="#000000" width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"/><path fill="none" d="M0 0h24v24H0V0z"/></svg>',w='<svg class="btnColCollapse" id="arrowRight" fill="#000000" width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/><path fill="none" d="M0 0h24v24H0V0z"/></svg>',m=$(window),v=$(".pivot-table"),b=$(".body"),k=$(".top-head"),C=$("table",k),x=$(".top-head-wrapper"),y=$(".side-head"),A=$("table",y),I=$(".footer"),D=$(".menu"),z=$(".veil"),M=$(".reader");let T=$(".header"),S="bubble";function L(t){return 94+8*(t%=5)}function F(t,s){const o=[],a=l.filter(e=>{if(!e.hasOwnProperty("Codes"))return!1;if(t.length>0&&s.length>0)for(const l of t)for(const t of s){if(e.Codes.filter(e=>e.AttributeId===l||e.AttributeId===t).length>=2)return!0}else for(const l of e.Codes)if(0===t.length){if(s.indexOf(l.AttributeId)>=0)return!0}else if(0===s.length&&t.indexOf(l.AttributeId)>=0)return!0;return!1});for(const t of a){const l=e.filter(t=>t.checked);let s=0===l.length;for(const e of l){s=!1;for(const l of e.children.filter(t=>t.checked)){if(t.Codes.filter(t=>t.AttributeId===l.id).length>0){s=!0;break}}if(!s)break}s&&o.push(t)}return o}function R(){let t=0;$(".cell",b).off(),$(".pie-wrapper").off().detach().remove(),$(".data-wrapper").off().detach().remove(),$(".cell",b).each((e,l)=>{const s=$(l),o=s.data("colid"),a=s.data("rowid"),i=F([a],[o]),c=function(t,e){let l=[];if(0===n.length)l.push({id:t+"-"+e,attribute:null,color:"#1976d2",count:0,width:0,size:0});else for(const t of n)l.push({id:t.attribute.AttributeId,attribute:t.attribute,color:t.color,count:0,width:0,size:0});return l}(a,o);let r=0;for(const t of i)for(const e of c){if(null===e.attribute){r+=1,e.count+=1;continue}t.Codes.filter(t=>t.AttributeId===e.id).length>0&&(e.count+=1,r+=1)}0===r?s.addClass("none"):s.removeClass("none"),r>t&&(t=r);for(const t of c)t.width=0===r||0===t.count?0:Math.round(t.count/r*100),t.width<4&&0!==t.width&&(t.width=4);s.data("totalSize",0),s.data("totalCount",r),s.data("counts",c);let d="";if(c.length>0&&"donut"===S){const t=function(t){let e=0,l="";for(const s of t)e+=s.width,l.length>0&&(l+=", "),l+=s.color+" 0 "+e+"%";e<100&&(l.length>0&&(l+=", "),l+="#eeeeee 0");const s=new ConicGradient({stops:l,size:97}),o=s.png;return $(s.canvas).empty().remove(),delete s.canvas,o}(c);t.length>0&&(d=' style="background-image: url('+t+')"')}let h='<div class="pie-wrapper"><div class="pie"'+d+'></div><div class="pie-hole"></div></div><div class="mosaic-wrapper"></div><div class="data-wrapper">';for(const t of c)h+='<div id="'+t.id+'" class="data" style="background-color: '+t.color+';"></div>';h+="</div>",s.html(h)}),$(".cell",b).each((e,l)=>{const s=$(l),o=s.data("totalCount"),a=s.data("counts");for(const e of a)e.size=0===e.count?0:Math.round(e.count/t*100);const n=0===o?0:Math.round(o/t*100);s.data("counts",a),s.data("totalSize",n),s.data("maxCount",t)}),$(".cell").hover(t=>{const e=$(t.currentTarget),l=e.data("totalCount");if(l<=0)return;const s=e.data("counts");let o='<div class="tooltip">';for(const t of s){if(0===t.count)continue;let e="Study";t.count>1&&(e="Studies"),null!==t.attribute&&(e=t.attribute.AttributeName),o+='<div class="count"><span style="background-color: '+t.color+';">'+t.count+"</span> "+e+"</div>"}o+="</div>",$(o).appendTo("body").fadeIn("fast")},t=>{$(".tooltip").remove(),$(".tooltip")}).mousemove(t=>{$(".tooltip").css({top:t.pageY+10,left:t.pageX+10})}),$(".clickable-row").on("click",t=>{const e=$(t.currentTarget),l=e.data("id");V([l],[])}),$(".clickable-col").on("click",t=>{const e=$(t.currentTarget),l=e.data("id");V([],[l])}),$(".cell").on("click",t=>{const e=$(t.currentTarget),l=e.data("totalCount"),s=e.data("colid"),o=e.data("rowid");0!==l&&V([o],[s])})}function E(){$(".cell",b).each((t,e)=>{const l=$(e),s=l.data("counts"),o=l.data("totalSize"),a=l.data("totalWidth"),n=l.data("maxCount");if("donut"===S){const t=100*o/100;let e=o-t/100*24;return e<0&&(e=0),$(".pie-wrapper",l).css({display:"block"}),$(".pie",l).css({width:t+"%",height:t+"%"}),$(".pie-hole",l).css({width:e+"%",height:e+"%"}),$(".data-wrapper",l).css({display:"none"}),void $(".mosaic-wrapper",l).css({display:"none"})}if($(".pie-wrapper",l).css({display:"none"}),$(".mosaic-wrapper",l).css({display:"none"}),$(".data-wrapper",l).css({display:"block"}),$(".data-wrapper",l).css({display:"heat"===S?"flex":"block",opacity:"heat"===S?o/100:1}),"mosaic"===S){$(".pie-wrapper",l).css({display:"none"}),$(".data-wrapper",l).css({display:"none"}),$(".mosaic-wrapper",l).css({display:"block"});const t=function(t,e){let l=Math.round(Math.sqrt(t));for(;e%l!=0&&l<e;)l+=1;return e/l}(n,100),e=s.map(t=>new Array(t.count).fill(t.color));let o=function(t,e){let l=0,s=0,o=`<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">\n   <defs>\n   <pattern id="grid" width="${t}" height="${t}" patternUnits="userSpaceOnUse">\n   <path d="M ${t} 0 L 0 0 0 ${t}" fill="none" stroke="white" stroke-width="0.5" />\n   </pattern>\n   </defs >\n    <rect width="100%" height="100%" fill="url(#grid)" />`;for(const a of e)o+=`<rect width="${t}" height="${t}" fill="${a}" x="${l}" y="${s}" stroke="white" stroke-width="0.5" />`,(l+=t)>90&&(l=0,s+=t);return o+="</svg >"}(t,[].concat.apply([],e));$(".mosaic-wrapper",l).html(o)}$(".data",l).css({"border-radius":"heat"===S?"0%":"100%",position:"bubble"===S?"absolute":"relative"});for(const[t,e]of s.entries()){let s=100*e.size/100;s<4&&0!==s&&(s=4);const o=s/2;let a=50-o,n=50-o,i=0;s>50&&(i=s-50),null!==e.attribute&&(0===t?(a-=o-i,n-=o-i):1===t?(a+=o-i,n-=o-i):2===t?(a-=o-i,n+=o-i):3===t&&(a+=o-i,n+=o-i)),$("#"+e.id,l).css({height:"bubble"===S?s+"%":"100%",width:"bubble"===S?s+"%":e.width+"%",transform:"bubble"===S?"translate("+a+"px, "+n+"px)":"translate(0, 0)"})}setTimeout(function(){$(".data-wrapper",l).css({opacity:"heat"===S?a/100:1})},500)})}function O(t,e,l){for(const s of t)e===s.id&&(s.checked="checked"===l||"indeterminate"===l),s.children.length>0&&O(s.children,e,l)}function H(t,l=""){const s=t.attr("class");0===l.length&&(l="checked"===s?"unchecked":"checked");const o=t.next();if(o.is("ul")&&o.children().each(function(){H($(this),l)}),t.is("li")){const o=t.data("id");O(e,o,l),t.removeClass(s).addClass(l),function(t){let l=!1,s=!1,o=!1;t.next().children().each(function(){const t=$(this).attr("class");"checked"===t?l=!0:"unchecked"===t?s=!0:o=!0});let a="";if(!l||s||o?l||!s||o?(l&&s&&!o||l&&!s&&o||!l&&s&&o||l&&s&&o)&&(a="indeterminate"):a="unchecked":a="checked",a.length>0){const l=t.data("id");O(e,l,a),t.removeClass(t.attr("class")).addClass(a)}}(t.parent().prev())}}function B(t,e){let l="";const s={ParentTitle:"Journal"};if(t!==i&&void 0!==e[t]&&e[t].length>0){const o=s[t];let a="";l+='<div class="meta-data-item clearfix">',l+="<label>"+(a=void 0!==o?o:t).replace(/([^A-Z])([A-Z])/g,"$1 $2")+"</label>",l+="<span>"+e[t]+"</span>",l+="</div>"}return l}function q(t){const e=l.filter(e=>e.ItemId===t);if(0===e.length)return void $(".read").html("");const s=e[0];let o="<h2>"+s.Title+"</h2>";o+="<hr>",void 0!==s.Abstract&&s.Abstract.length>0?(o+="<p>"+s.Abstract+"</p>",o+="<hr>"):i.length>0&&void 0!==s[i]&&s[i].length>0&&(o+="<p>"+s[i]+"</p>",o+="<hr>"),void 0!==s.URL&&s.URL.length>0&&(o+='<ol class="refs">',o+='<li><a class="small" href="'+s.URL+'" target="_blank">'+s.URL+"</a></li>",void 0!==s.DOI&&0!==s.DOI.length||(o+="</ol>",o+="<hr>")),void 0!==s.DOI&&s.DOI.length>0&&(void 0!==s.URL&&0!==s.URL.length||(o+='<ol class="refs">'),o+='<li><a class="small" href="'+s.DOI+'" target="_blank">'+s.DOI+"</a></li>",o+="</ol>",o+="<hr>"),o+='<div class="meta-data">';for(const t of a)o+=B(t,s);o+="</div>",$(".read").html(o)}function N(t){$(".refMenuItem").off(),t.sort(function(t,e){return t.Title>e.Title?1:t.Title<e.Title?-1:0});let e="";e=1===t.length?t.length+" Reference":t.length+" References";let l="<ul>";for(const e of t){let t=[];for(const l of e.Codes)for(const e of n)l.AttributeId===e.attribute.AttributeId&&t.push(e.color);l+='<li class="refMenuItem" data-refid="'+e.ItemId+'"><div class="title">'+e.Title+'</div><div class="auth">'+e.Authors+"</div>",l+='<div class="date">',0!==e.Month.length&&(l+=e.Month+", "),l+=e.Year;for(let e of t)l+='<span class="refMenuItemLegend" style="background-color: '+e+'" />';l+="</div>",l+="</li>"}l+="</ul>",$(".title > span",M).html(e),$(".nav",M).html(l),$(".refMenuItem").on("click",t=>{$(".refMenuItem").removeClass("selected");const e=$(t.currentTarget),l=e.data("refid");e.addClass("selected"),q(l)}),t.length>0?$($(".refMenuItem")[0]).trigger("click"):q(0)}function U(e,l){let s='<div class="title clearfix"><a class="close">X</a> <span></span><input type="text" placeholder="Filter" class="reader-filter"></div><div class="content">'+function(e,l){const s=t.rows[t.totalColDepth-1],o=[];for(let e=t.totalColDepth;e<t.rows.length;e++){const l=t.rows[e];o.push(l[l.length-1])}let a=s.length===l.length?"checked":"indeterminate";0===l.length&&(a="unchecked");let n='<div class="reader-filter"><ul><li class="'+a+'" data-parent="true" title="'+t.rows[0][0].title+'">'+c+r+d+" <span>"+t.rows[0][0].title+'</span></li><ul class="cols">';for(const t of s)n+='<li class="'+(l.indexOf(t.id)>=0?"checked":"unchecked")+'" data-id="'+t.id+'" data-parent="false" title="'+t.title+'">'+c+r+d+" <span>"+t.title+"</span></li>";let i=o.length===e.length?"checked":"indeterminate";0===e.length&&(i="unchecked"),n+="</ul>",n+='<li class="'+i+'" data-parent="true" title="'+t.rows[t.totalColDepth][0].title+'">'+c+r+d+" <span>"+t.rows[t.totalColDepth][0].title+"</span></li>",n+='<ul class="rows">';for(const t of o)n+='<li class="'+(e.indexOf(t.id)>=0?"checked":"unchecked")+'" data-id="'+t.id+'" data-parent="false" title="'+t.title+'">'+c+r+d+" <span>"+t.title+"</span></li>";return n+="</ul>",n+="</ul>",n+="</div>"}(e,l)+'<div class="nav"></div><div class="read"></div></div>';M.html(s)}function V(t,e){const l=F(t,e);U(t,e),N(l);const s=$(".reader-filter");s.bind("keyup change",t=>{const e=s.val().toLowerCase().trim(),l=$(".refMenuItem");l.removeClass("hide"),e.length<=0||l.filter((t,l)=>$(".title",l).text().toLowerCase().indexOf(e)<0).addClass("hide")}),$(".reader-filter li").on("click",t=>{const e=$(t.currentTarget),l=e.attr("class"),s=e.data("parent"),o="checked"===l?"unchecked":"checked";if(e.removeClass(l).addClass(o),s)e.next().children().each((t,e)=>{$(e).removeClass("checked").removeClass("unchecked").addClass(o)});else{const t=e.parent().prev();$(t).removeClass("checked").removeClass("unchecked").addClass("indeterminate")}const a=function(){const t=[],e=[];return $(".reader-filter .cols li").each((e,l)=>{const s=$(l);"checked"===s.attr("class")&&t.push(s.data("id"))}),$(".reader-filter .rows li").each((t,l)=>{const s=$(l);"checked"===s.attr("class")&&e.push(s.data("id"))}),{cols:t,rows:e}}();N(F(a.rows,a.cols))}),$(".close",M).on("click",()=>{$(".refMenuItem").off(),$(".reader-filter li").off(),M.removeClass("open"),z.removeClass("open")}),z.addClass("open"),M.addClass("open")}function P(){const t=v.width()-y.width(),e=k.height(),l=y.width(),s=t,o=t-1;let a=m.height()-k.height()-I.height()-D.height()-278,n=a;(T=$(".header")).length>0&&"none"!==T.css("display")&&(n=a=a-T.height()-8),x.css({height:e,"padding-left":l}),k.css({width:s}),C.css({"margin-left":"0px"}),y.css({height:a}),A.css({"margin-top":"0px"}),b.css({overflow:"scroll",width:o,height:n}),b.scroll(function(t){C.css({"margin-left":-1*t.target.scrollLeft}),A.css({"margin-top":-1*t.target.scrollTop})})}!function(){const t=$(".settings");let l='<div class="title clearfix"><span>Filters</span><a class="btnSettings right" id="close">X</a><a class="btnSettings left disabled" id="update">update</a></div>';function s(){const e=$(this);e.addClass("busy"),setTimeout(()=>{R(),E(),t.removeClass("open"),z.removeClass("open"),e.removeClass("busy").addClass("disabled"),e.off("click")},300)}l+=function(){let t='<div class="filter-wrapper"><h2>Filters</h2>';return t+=function t(e){let l="<ul>";for(const s of e)l+='<li class="unchecked" data-id="'+s.id+'">'+c+r+d+" <span>"+s.label+"</span></li>",s.children.length>0&&(l+=t(s.children));return l+="</ul>"}(e),t+="</div>"}(),l+=function(){let t=h+u+' <span>Bubble-map</span></li><li class="unchecked" data-id="heat">'+h+u+' <span>Heat-map</span></li><li class="unchecked" data-id="mosaic">'+h+u+" <span>Mosiac</span></li>";return 0!==n.length&&(t+='<li class="unchecked" data-id="donut">'+h+u+" <span>Donut-map</span></li>"),t+="</ul>"}(),t.html(l),$(".filter-wrapper li",t).on("click",e=>{H($(e.currentTarget)),$(".disabled").removeClass("disabled"),$("#update",t).on("click",s)}),$(".menu-settings").on("click",function(){console.log("hello"),t.addClass("open"),z.addClass("open")}),$("#close",t).on("click",function(){t.removeClass("open"),z.removeClass("open")})}(),function(){let e="",l="",o=[];for(let s=0;s<t.totalColDepth;s++){let a="";s>0&&s+1<t.totalColDepth?l="header-can-hide":s+1===t.totalColDepth?(a="clickable-col",l=""):l="";const n=t.rows[s];e+='<tr class="'+l+'">';for(let l=0;l<n.length;l++){const i=n[l],c=0===s&&0===l?t.totalColBreadth:i.span;let r="";if(1===s){r='style="background-color:hsla(210, 16%,'+L(l)+'%, 1)"';for(let t=0;t<c;t++)o.push(r)}s>1&&(r=o[l]);let d="";"clickable-col"===a&&(d=' data-id="'+i.id+'"'),e+='<th class="'+a+'" colspan="'+c+'"'+r+d+">",e+="<div>",1===s&&(e+=g,e+=w),e+="<span>",e+=i.title,e+="</span></div>",e+="</th>"}e+="</tr>"}$("table thead",k).append(e),s=$("table",k).height(),$("table",k).height(s)}(),function(){let e="",l="",s=0,a="";for(let o=t.totalColDepth;o<t.rows.length;o++){const n=t.rows[o];e+="<tr>";for(let i=0;i<n.length;i++){const c=n[i],r=o===t.totalColDepth&&0===i?t.totalRowBreadth:c.span,d=t.totalColDepth-n.length+i;1===d&&(s+=1,a="background-color:hsla(210, 16%,"+L(i)+"%, 1)");let h="";"clickable-row vertical-text"==(l=d>0&&d+1<t.totalColDepth?"header-can-hide vertical-text":d+1===t.totalColDepth?"clickable-row vertical-text":"vertical-text")&&(h=' data-id="'+c.id+'"'),e+='<th class="level-'+d+" "+l+'" rowspan="'+r+'" style="'+a+'"'+h+">",e+="<div>",1===d&&(e+=p,e+=f),e+="<span>",e+=c.title,e+="</span></div>",e+="</th>"}e+="</tr>"}$("table tbody",y).append(e),o=$("table",y).width(),$("table",y).width(o)}(),function(){let e="";const l=t.rows[t.totalColDepth-1];for(let s=t.totalColDepth;s<t.rows.length;s++){const o=t.rows[s];e+="<tr>";for(let t=0;t<l.length;t++){const s=l[t],a=o[o.length-1].id;e+='<td class="cell" data-colid="'+s.id+'" data-rowid="'+a+'"></td>'}e+="</tr>"}$("table tbody",b).html(e)}(),R(),E(),P(),function(){if(null===n)return;let t="";n.forEach(e=>{t+='<li><span class="dot" style="background-color: '+e.color+'"></span><span class="label">'+e.attribute.AttributeName+"</span></li>"}),$(".legend").html(t)}(),function(){const t=$(".menu-expand"),e=$("table",k),l=$("table",y);t.on("click",a=>{t.toggleClass("active"),t.hasClass("active")?(e.height("auto"),l.width("auto")):(e.height(s),l.width(o)),$(".header, .header-can-hide").slideToggle(200,function(){P()})})}(),function(){const t=$(".menu-fullscreen");t.on("click",e=>{document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),t.toggleClass("active")})}(),function(){const e=$(".menu-reader"),l=t.rows[t.totalColDepth-1].map(t=>t.id),s=[];for(let e=t.totalColDepth;e<t.rows.length;e++){const l=t.rows[e];s.push(l[l.length-1].id)}e.on("click",t=>{V(s,l),e.toggleClass("active")})}(),$(".btnColCollapse").on("click",t=>{const e=$(t.currentTarget).parent().parent();e.toggleClass("collapsed");const l=parseInt(e.attr("colspan"));let s=0,o=e.prev();for(;o.length>0;)try{s+=parseInt(o.attr("colspan")),o=o.prev()}catch(t){break}l>0&&function(t,e){const l=t+e;$(".top-head tr").each((e,s)=>{if(e<=1)return;let o=0;$(s).children().each((e,s)=>{const a=$(s),n=parseInt(a.attr("colspan"));if((o+=n)>t&&o<=l)a.toggleClass("collapsed");else if(o>l)return!1})}),$(".body tr").each((e,s)=>{let o=0;$(s).children().each((e,s)=>{const a=$(s);if((o+=1)>t&&o<=l)a.toggleClass("collapsed-col");else if(o>l)return!1})})}(s,l)}),$(".btnRowCollapse").on("click",t=>{const e=$(t.currentTarget).parent().parent();e.toggleClass("collapsed");const l=parseInt(e.attr("rowspan"));let s=0;$(".level-1").each((t,l)=>{const o=$(l);if(o.text()===e.text())return!1;s+=parseInt(o.attr("rowspan"))}),l>0&&function(t,e){const l=t+e;console.warn("miss",t,"max",l);let s=0;$(".level-2").each((e,o)=>{const a=$(o),n=parseInt(a.attr("rowspan"));if((s+=n)>t&&s<=l)a.toggleClass("collapsed");else if(s>l)return!1}),s=0,$(".level-3").each((e,o)=>{const a=$(o),n=parseInt(a.attr("rowspan"));if((s+=n)>t&&s<=l)a.toggleClass("collapsed");else if(s>l)return!1}),$(".body tr").each((e,s)=>{e<t||e>=l||(console.warn("rowIndex",e),$(s).children().each((t,e)=>{$(e).toggleClass("collapsed-row")}))})}(s,l)});const J=$(".loader"),Y=m.height()+200;m.resize(P),J.css({top:-Y,bottom:Y}),setTimeout(()=>{J.remove()},10)})})})});
