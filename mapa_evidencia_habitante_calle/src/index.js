$(window).on("load",function(){$.getJSON("./src/data/csvData.json",function(e){$.getJSON("./src/data/filters.json",function(t){$.getJSON("./src/data/referenceData.json",function(l){let s="auto",a="auto";const o=["Title","Authors","Year","ParentTitle","Volume","Issue","Pages","URL","DOI"],i="<div>\x3c!--block--\x3eThe purpose of this Evidence and Gap Map (EGM) is to provide easy access to the available evidence on&nbsp; the effectiveness of Interventions in improving the lives of those who experience, or are at risk of experiencing, homelessness.&nbsp;<br><br>The map is a table or matrix which provides a visual presentation of the evidence. In the homelessness map the rows are intervention categories and the columns are indicator categories. Indicators have sub-categories. For example, the employment indicator has three sub-categories: (1) employment status (paid and unpaid work), (2) earned income, and (3) forced labour and sex work. The map has four version Bubble, heat, donut&nbsp; and Mosaic which are self-explanatory.<br><br>The map shows both impact evaluations and systematic reviews. Impact evaluations are studies using quantitative approaches to measure what difference the programme made to outcomes like housing stability. Systematic reviews are studies which summarise all available relevant evidence for a particular issue or question. Systematic reviews which summarise evidence from impact evaluations are called ‘effectiveness reviews’<br><br>This EGM also identifies key ‘gaps’, cells which do not have any bubbles, indicates there no evidence.<br><br>This map was commissioned by the Centre for Homelessness Impact and created in partnership by Campbell Collaboration and Centre for Homelessness Impact.</div>",n="<div>\x3c!--block--\x3eDo you know of any impact evaluations for homelessness that are missing from the map?<br><br>Please let us know by emailing hello@homelessnessimpact.org with a link to the study.<br><br></div>",r=[{attribute:{AttributeSetId:5414315,AttributeId:504,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"Estudio de metodos mixtos",AttributeDescription:""},color:"#E22222"},{attribute:{AttributeSetId:5414325,AttributeId:507,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"Observacional",AttributeDescription:""},color:"#75C127"},{attribute:{AttributeSetId:5414325,AttributeId:509,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"Revisión Sistemática con Metaanálisis",AttributeDescription:""},color:"#FF33DF"},{attribute:{AttributeSetId:5414325,AttributeId:510,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"Revisión Sistemática",AttributeDescription:""},color:"#FF5333"},{attribute:{AttributeSetId:54143351,AttributeId:506,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"Experimento controlado aleatorizado",AttributeDescription:""},color:"#24A1CE"},{attribute:{AttributeSetId:54143352,AttributeId:508,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"Revisión Sistemática",AttributeDescription:""},color:"#75FF33"},{attribute:{AttributeSetId:5414335,AttributeId:505,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"Evaluación económica",AttributeDescription:""},color:"#DBFF33"},{attribute:{AttributeSetId:54143353,AttributeId:501,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"Cuasi-experimento",AttributeDescription:""},color:"#3379FF"},{attribute:{AttributeSetId:54143354,AttributeId:502,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"Ensayo clínico",AttributeDescription:""},color:"#B933FF"},{attribute:{AttributeSetId:54143356,AttributeId:503,AttributeSetDescription:"",AttributeType:"Selectable (show checkbox)",AttributeName:"Estudio cualitativo",AttributeDescription:""},color:"#FFBD33"}],c="",d='<svg id="checked" fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',h='<svg id="unchecked" fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',u='<svg id="indeterminate" fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M0 0h24v24H0z" id="a"/></defs><clipPath id="b"><use overflow="visible" xlink:href="#a"/></clipPath><path clip-path="url(#b)" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"/></svg>',p='<svg class="btnRowCollapse" id="arrowUp" fill="#000000" width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',f='<svg class="btnRowCollapse" id="arrowDown" fill="#000000" width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/><path fill="none" d="M0 0h24v24H0V0z"/></svg>',b='<svg class="btnColCollapse" id="arrowLeft" fill="#000000" width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"/><path fill="none" d="M0 0h24v24H0V0z"/></svg>',m='<svg class="btnColCollapse" id="arrowRight" fill="#000000" width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/><path fill="none" d="M0 0h24v24H0V0z"/></svg>',v=$(window),g=$(".pivot-table"),w=$(".body"),k=$(".top-head"),C=$("table",k),A=$(".top-head-wrapper"),x=$(".side-head"),y=$("table",x),I=$(".footer"),S=$(".menu"),D=$(".veil"),T=$(".reader");let F=$(".header"),M="bubble";function z(e){return 24+8*(e%=5)}function E(e,s){const a=[],o=l.filter(t=>{if(!t.hasOwnProperty("Codes"))return!1;if(e.length>0&&s.length>0){for(const l of e)for(const e of s)if(t.Codes.filter(t=>t.AttributeId===l||t.AttributeId===e).length>=2)return!0}else for(const l of t.Codes)if(0===e.length){if(s.indexOf(l.AttributeId)>=0)return!0}else if(0===s.length&&e.indexOf(l.AttributeId)>=0)return!0;return!1});for(const e of o){const l=t.filter(e=>e.checked);let s=0===l.length;for(const t of l){s=!1;for(const l of t.children.filter(e=>e.checked)){if(e.Codes.filter(e=>e.AttributeId===l.id).length>0){s=!0;break}}if(!s)break}s&&a.push(e)}return a}function L(){let e=0;$(".cell",w).off(),$(".pie-wrapper").off().detach().remove(),$(".data-wrapper").off().detach().remove(),$(".cell",w).each((t,l)=>{const s=$(l),a=s.data("colid"),o=s.data("rowid"),i=E([o],[a]),n=function(e,t){let l=[];if(0===r.length)l.push({id:e+"-"+t,attribute:null,color:"#1976d2",count:0,width:0,size:0});else for(const e of r)l.push({id:e.attribute.AttributeId,attribute:e.attribute,color:e.color,count:0,width:0,size:0});return l}(o,a);let c=0;for(const e of i)for(const t of n){if(null===t.attribute){c+=1,t.count+=1;continue}e.Codes.filter(e=>e.AttributeId===t.id).length>0&&(t.count+=1,c+=1)}0===c?s.addClass("none"):s.removeClass("none"),c>e&&(e=c);for(const e of n)e.width=0===c||0===e.count?0:Math.round(e.count/c*100),e.width<4&&0!==e.width&&(e.width=4);s.data("totalSize",0),s.data("totalCount",c),s.data("counts",n);let d="";if(n.length>0&&"donut"===M){const e=function(e){let t=0,l="";for(const s of e)t+=s.width,l.length>0&&(l+=", "),l+=s.color+" 0 "+t+"%";t<100&&(l.length>0&&(l+=", "),l+="#eeeeee 0");const s=new ConicGradient({stops:l,size:97}),a=s.png;return $(s.canvas).empty().remove(),delete s.canvas,a}(n);e.length>0&&(d=' style="background-image: url('+e+')"')}let h='<div class="pie-wrapper"><div class="pie"'+d+'></div><div class="pie-hole"></div></div><div class="mosaic-wrapper"></div><div class="data-wrapper">';for(const e of n)h+='<div id="'+e.id+'" class="data" style="background-color: '+e.color+';"></div>';h+="</div>",s.html(h)}),$(".cell",w).each((t,l)=>{const s=$(l),a=s.data("totalCount"),o=s.data("counts");for(const t of o)t.size=0===t.count?0:Math.round(t.count/e*100);const i=0===a?0:Math.round(a/e*100);s.data("counts",o),s.data("totalSize",i),s.data("maxCount",e)}),$(".cell").hover(e=>{const t=$(e.currentTarget),l=t.data("totalCount");if(l<=0)return;const s=t.data("counts");let a='<div class="tooltip">';for(const e of s){if(0===e.count)continue;let t="Study";e.count>1&&(t="Studies"),null!==e.attribute&&(t=e.attribute.AttributeName),a+='<div class="count"><span style="background-color: '+e.color+';">'+e.count+"</span> "+t+"</div>"}a+="</div>",$(a).appendTo("body").fadeIn("fast")},e=>{$(".tooltip").remove(),$(".tooltip")}).mousemove(e=>{$(".tooltip").css({top:e.pageY+10,left:e.pageX+10})}),$(".clickable-row").on("click",e=>{const t=$(e.currentTarget),l=t.data("id");P([l],[])}),$(".clickable-col").on("click",e=>{const t=$(e.currentTarget),l=t.data("id");P([],[l])}),$(".cell").on("click",e=>{const t=$(e.currentTarget),l=t.data("totalCount"),s=t.data("colid"),a=t.data("rowid");0!==l&&P([a],[s])})}function R(){$(".cell",w).each((e,t)=>{const l=$(t),s=l.data("counts"),a=l.data("totalSize"),o=l.data("totalWidth"),i=l.data("maxCount");if("donut"===M){const e=100*a/100;let t=a-e/100*24;return t<0&&(t=0),$(".pie-wrapper",l).css({display:"block"}),$(".pie",l).css({width:e+"%",height:e+"%"}),$(".pie-hole",l).css({width:t+"%",height:t+"%"}),$(".data-wrapper",l).css({display:"none"}),void $(".mosaic-wrapper",l).css({display:"none"})}if($(".pie-wrapper",l).css({display:"none"}),$(".mosaic-wrapper",l).css({display:"none"}),$(".data-wrapper",l).css({display:"block"}),$(".data-wrapper",l).css({display:"heat"===M?"flex":"block",opacity:"heat"===M?a/100:1}),"mosaic"===M){$(".pie-wrapper",l).css({display:"none"}),$(".data-wrapper",l).css({display:"none"}),$(".mosaic-wrapper",l).css({display:"block"});const e=function(e,t){let l=Math.round(Math.sqrt(e));for(;t%l!=0&&l<t;)l+=1;return t/l}(i,100),t=s.map(e=>new Array(e.count).fill(e.color));let a=function(e,t){let l=0,s=0,a=`<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">\n     <defs>\n     <pattern id="grid" width="${e}" height="${e}" patternUnits="userSpaceOnUse">\n     <path d="M ${e} 0 L 0 0 0 ${e}" fill="none" stroke="white" stroke-width="0.5" />\n     </pattern>\n     </defs >\n      <rect width="100%" height="100%" fill="url(#grid)" />`;for(const o of t)a+=`<rect width="${e}" height="${e}" fill="${o}" x="${l}" y="${s}" stroke="white" stroke-width="0.5" />`,(l+=e)>90&&(l=0,s+=e);return a+="</svg >"}(e,[].concat.apply([],t));$(".mosaic-wrapper",l).html(a)}$(".data",l).css({"border-radius":"heat"===M?"0%":"100%",position:"bubble"===M?"absolute":"relative"});for(const[e,t]of s.entries()){let s=100*t.size/100;s<4&&0!==s&&(s=4);const a=s/2;let o=50-a,i=50-a,n=0;s>50&&(n=s-50),null!==t.attribute&&(0===e?(o-=a-n,i-=a-n):1===e?(o+=a-n,i-=a-n):2===e?(o-=a-n,i+=a-n):3===e&&(o+=a-n,i+=a-n)),$("#"+t.id,l).css({height:"bubble"===M?s+"%":"100%",width:"bubble"===M?s+"%":t.width+"%",transform:"bubble"===M?"translate("+o+"px, "+i+"px)":"translate(0, 0)"})}setTimeout(function(){$(".data-wrapper",l).css({opacity:"heat"===M?o/100:1})},500)})}function O(e,t,l){for(const s of e)t===s.id&&(s.checked="checked"===l||"indeterminate"===l),s.children.length>0&&O(s.children,t,l)}function N(e,l=""){const s=e.attr("class");0===l.length&&(l="checked"===s?"unchecked":"checked");const a=e.next();if(a.is("ul")&&a.children().each(function(){N($(this),l)}),e.is("li")){const a=e.data("id");O(t,a,l),e.removeClass(s).addClass(l),function(e){let l=!1,s=!1,a=!1;e.next().children().each(function(){const e=$(this).attr("class");"checked"===e?l=!0:"unchecked"===e?s=!0:a=!0});let o="";if(!l||s||a?l||!s||a?(l&&s&&!a||l&&!s&&a||!l&&s&&a||l&&s&&a)&&(o="indeterminate"):o="unchecked":o="checked",o.length>0){const l=e.data("id");O(t,l,o),e.removeClass(e.attr("class")).addClass(o)}}(e.parent().prev())}}function B(e,t){let l="";const s={ParentTitle:"Journal"};if(e!==c&&void 0!==t[e]&&t[e].length>0){const a=s[e];let o="";l+='<div class="meta-data-item clearfix">',l+="<label>"+(o=void 0!==a?a:e).replace(/([^A-Z])([A-Z])/g,"$1 $2")+"</label>",l+="<span>"+t[e]+"</span>",l+="</div>"}return l}function H(e){const t=l.filter(t=>t.ItemId===e);if(0===t.length)return void $(".read").html("");const s=t[0];let a="<h2>"+s.Title+"</h2>";a+="<hr>",void 0!==s.Abstract&&s.Abstract.length>0?(a+="<p>"+s.Abstract+"</p>",a+="<hr>"):c.length>0&&void 0!==s[c]&&s[c].length>0&&(a+="<p>"+s[c]+"</p>",a+="<hr>"),void 0!==s.URL&&s.URL.length>0&&(a+='<ol class="refs">',a+='<li><a class="small" href="'+s.URL+'" target="_blank">'+s.URL+"</a></li>",void 0!==s.DOI&&0!==s.DOI.length||(a+="</ol>",a+="<hr>")),void 0!==s.DOI&&s.DOI.length>0&&(void 0!==s.URL&&0!==s.URL.length||(a+='<ol class="refs">'),a+='<li><a class="small" href="'+s.DOI+'" target="_blank">'+s.DOI+"</a></li>",a+="</ol>",a+="<hr>"),a+='<div class="meta-data">';for(const e of o)a+=B(e,s);a+="</div>",$(".read").html(a)}function q(e){$(".refMenuItem").off(),e.sort(function(e,t){return e.Title>t.Title?1:e.Title<t.Title?-1:0});let t="";t=1===e.length?e.length+" Reference":e.length+" References";let l="<ul>";for(const t of e){let e=[];for(const l of t.Codes)for(const t of r)l.AttributeId===t.attribute.AttributeId&&e.push(t.color);l+='<li class="refMenuItem" data-refid="'+t.ItemId+'"><div class="title">'+t.Title+'</div><div class="auth">'+t.Authors+"</div>",l+='<div class="date">',0!==t.Month.length&&(l+=t.Month+", "),l+=t.Year;for(let t of e)l+='<span class="refMenuItemLegend" style="background-color: '+t+'" />';l+="</div>",l+="</li>"}l+="</ul>",$(".title > span",T).html(t),$(".nav",T).html(l),$(".refMenuItem").on("click",e=>{$(".refMenuItem").removeClass("selected");const t=$(e.currentTarget),l=t.data("refid");t.addClass("selected"),H(l)}),e.length>0?$($(".refMenuItem")[0]).trigger("click"):H(0)}function U(t,l){let s='<div class="title clearfix"><a class="close">X</a> <span></span><input type="text" placeholder="Filter" class="reader-filter"></div><div class="content">'+function(t,l){const s=e.rows[e.totalColDepth-1],a=[];for(let t=e.totalColDepth;t<e.rows.length;t++){const l=e.rows[t];a.push(l[l.length-1])}let o=s.length===l.length?"checked":"indeterminate";0===l.length&&(o="unchecked");let i='<div class="reader-filter"><ul><li class="'+o+'" data-parent="true" title="'+e.rows[0][0].title+'">'+d+h+u+" <span>"+e.rows[0][0].title+'</span></li><ul class="cols">';for(const e of s)i+='<li class="'+(l.indexOf(e.id)>=0?"checked":"unchecked")+'" data-id="'+e.id+'" data-parent="false" title="'+e.title+'">'+d+h+u+" <span>"+e.title+"</span></li>";let n=a.length===t.length?"checked":"indeterminate";0===t.length&&(n="unchecked"),i+="</ul>",i+='<li class="'+n+'" data-parent="true" title="'+e.rows[e.totalColDepth][0].title+'">'+d+h+u+" <span>"+e.rows[e.totalColDepth][0].title+"</span></li>",i+='<ul class="rows">';for(const e of a)i+='<li class="'+(t.indexOf(e.id)>=0?"checked":"unchecked")+'" data-id="'+e.id+'" data-parent="false" title="'+e.title+'">'+d+h+u+" <span>"+e.title+"</span></li>";return i+="</ul>",i+="</ul>",i+="</div>"}(t,l)+'<div class="nav"></div><div class="read"></div></div>';T.html(s)}function P(e,t){const l=E(e,t);U(e,t),q(l);const s=$(".reader-filter");s.bind("keyup change",e=>{const t=s.val().toLowerCase().trim(),l=$(".refMenuItem");l.removeClass("hide"),t.length<=0||l.filter((e,l)=>$(".title",l).text().toLowerCase().indexOf(t)<0).addClass("hide")}),$(".reader-filter li").on("click",e=>{const t=$(e.currentTarget),l=t.attr("class"),s=t.data("parent"),a="checked"===l?"unchecked":"checked";if(t.removeClass(l).addClass(a),s)t.next().children().each((e,t)=>{$(t).removeClass("checked").removeClass("unchecked").addClass(a)});else{const e=t.parent().prev();$(e).removeClass("checked").removeClass("unchecked").addClass("indeterminate")}const o=function(){const e=[],t=[];return $(".reader-filter .cols li").each((t,l)=>{const s=$(l);"checked"===s.attr("class")&&e.push(s.data("id"))}),$(".reader-filter .rows li").each((e,l)=>{const s=$(l);"checked"===s.attr("class")&&t.push(s.data("id"))}),{cols:e,rows:t}}();q(E(o.rows,o.cols))}),$(".close",T).on("click",()=>{$(".refMenuItem").off(),$(".reader-filter li").off(),T.removeClass("open"),D.removeClass("open")}),D.addClass("open"),T.addClass("open")}function V(){const e=g.width()-x.width(),t=k.height(),l=x.width(),s=e,a=e-1;let o=v.height()-k.height()-I.height()-S.height()-100,i=o-195;(F=$(".header")).length>0&&"none"!==F.css("display")&&(i=o=o-F.height()-280),A.css({height:t,"padding-left":l}),k.css({width:s}),C.css({"margin-left":"0px"}),x.css({height:o}),y.css({"margin-top":"0px"}),w.css({overflow:"scroll",width:a,height:i}),w.scroll(function(e){C.css({"margin-left":-1*e.target.scrollLeft}),y.css({"margin-top":-1*e.target.scrollTop})})}!function(){const e=$(".settings");let l='<div class="title clearfix"><span>Filtros</span><a class="btnSettings right" id="close">X</a><a class="btnSettings left disabled" id="update">cargar</a></div>';function s(){const t=$(this);t.addClass("busy"),setTimeout(()=>{L(),R(),e.removeClass("open"),D.removeClass("open"),t.removeClass("busy").addClass("disabled"),t.off("click")},300)}l+=function(){let e='<div class="filter-wrapper"><h2>Filters</h2>';return e+=function e(t){let l="<ul>";for(const s of t)l+='<li class="unchecked" data-id="'+s.id+'">'+d+h+u+" <span>"+s.label+"</span></li>",s.children.length>0&&(l+=e(s.children));return l+="</ul>"}(t),e+="</div>"}(),e.html(l),$(".filter-wrapper li",e).on("click",t=>{N($(t.currentTarget)),$(".disabled").removeClass("disabled"),$("#update",e).on("click",s)}),$(".style-wrapper li",e).on("click",t=>{!function(e,t){"checked"!==t.attr("class")&&(M=t.data("id"),$(".style-wrapper li",e).removeClass("checked").addClass("unchecked"),t.removeClass("unchecked").addClass("checked"))}(e,$(t.currentTarget)),$(".disabled").removeClass("disabled"),$("#update",e).on("click",s)}),$(".menu-settings").on("click",function(){e.addClass("open"),D.addClass("open")}),$("#close",e).on("click",function(){e.removeClass("open"),D.removeClass("open")})}(),function(){let t="",l="",a=[];for(let s=0;s<e.totalColDepth;s++){let o="";s>0&&s+1<e.totalColDepth?l="header-can-hide":s+1===e.totalColDepth?(o="clickable-col",l=""):l="";const i=e.rows[s];t+='<tr class="'+l+'">';for(let l=0;l<i.length;l++){const n=i[l],r=0===s&&0===l?e.totalColBreadth:n.span;let c="";if(1===s){c='style="background-color:hsla(170, 45%,'+z(l)+'%, 1)"';for(let e=0;e<r;e++)a.push(c)}s>1&&(c=a[l]);let d="";"clickable-col"===o&&(d=' data-id="'+n.id+'"'),t+='<th class="'+o+'" colspan="'+r+'"'+c+d+">",t+="<div>",1===s&&(t+=b,t+=m),t+="<span>",t+=n.title,t+="</span></div>",t+="</th>"}t+="</tr>"}$("table thead",k).append(t),s=$("table",k).height(),$("table",k).height(s)}(),function(){let t="",l="",s=0,o="";for(let a=e.totalColDepth;a<e.rows.length;a++){const i=e.rows[a];t+="<tr>";for(let n=0;n<i.length;n++){const r=i[n],c=a===e.totalColDepth&&0===n?e.totalRowBreadth:r.span,d=e.totalColDepth-i.length+n;1===d&&(o="background-color:hsla(170, 45%,"+z(s+=1)+"%, 1)");let h="";"clickable-row vertical-text"==(l=d>0&&d+1<e.totalColDepth?"header-can-hide vertical-text":d+1===e.totalColDepth?"clickable-row vertical-text":"vertical-text")&&(h=' data-id="'+r.id+'"'),t+='<th class="level-'+d+" "+l+'" rowspan="'+c+'" style="'+o+'"'+h+">",t+="<div>",1===d&&(t+=p,t+=f),t+="<span>",t+=r.title,t+="</span></div>",t+="</th>"}t+="</tr>"}$("table tbody",x).append(t),a=$("table",x).width(),$("table",x).width(a)}(),function(){let t="";const l=e.rows[e.totalColDepth-1];for(let s=e.totalColDepth;s<e.rows.length;s++){const a=e.rows[s];t+="<tr>";for(let e=0;e<l.length;e++){const s=l[e],o=a[a.length-1].id;t+='<td class="cell" data-colid="'+s.id+'" data-rowid="'+o+'"></td>'}t+="</tr>"}$("table tbody",w).html(t)}(),L(),R(),V(),function(){if(null===r)return;let e="";r.forEach(t=>{e+='<span class="dot" style="background-color: '+t.color+'"></span><span class="label">'+t.attribute.AttributeName+"</span>"}),$(".legend").html(e)}(),function(){const e=$(".menu-expand"),t=$("table",k),l=$("table",x);e.on("click",o=>{e.toggleClass("active"),e.hasClass("active")?(t.height("auto"),l.width("auto")):(t.height(s),l.width(a)),$(".header, .header-can-hide").slideToggle(200,function(){V()})})}(),function(){const e=$(".menu-fullscreen");e.on("click",t=>{document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),e.toggleClass("active")})}(),function(){const t=$(".menu-reader"),l=e.rows[e.totalColDepth-1].map(e=>e.id),s=[];for(let t=e.totalColDepth;t<e.rows.length;t++){const l=e.rows[t];s.push(l[l.length-1].id)}t.on("click",e=>{P(s,l),t.toggleClass("active")})}(),$(".btnColCollapse").on("click",e=>{const t=$(e.currentTarget).parent().parent();t.toggleClass("collapsed");const l=parseInt(t.attr("colspan"));let s=0,a=t.prev();for(;a.length>0;)try{s+=parseInt(a.attr("colspan")),a=a.prev()}catch(e){break}l>0&&function(e,t){const l=e+t;$(".top-head tr").each((t,s)=>{if(t<=1)return;let a=0;$(s).children().each((t,s)=>{const o=$(s),i=parseInt(o.attr("colspan"));if((a+=i)>e&&a<=l)o.toggleClass("collapsed");else if(a>l)return!1})}),$(".body tr").each((t,s)=>{let a=0;$(s).children().each((t,s)=>{const o=$(s);if((a+=1)>e&&a<=l)o.toggleClass("collapsed-col");else if(a>l)return!1})})}(s,l)}),$(".btnRowCollapse").on("click",e=>{const t=$(e.currentTarget).parent().parent();t.toggleClass("collapsed");const l=parseInt(t.attr("rowspan"));let s=0;$(".level-1").each((e,l)=>{const a=$(l);if(a.text()===t.text())return!1;s+=parseInt(a.attr("rowspan"))}),l>0&&function(e,t){const l=e+t;console.warn("miss",e,"max",l);let s=0;$(".level-2").each((t,a)=>{const o=$(a),i=parseInt(o.attr("rowspan"));if((s+=i)>e&&s<=l)o.toggleClass("collapsed");else if(s>l)return!1}),s=0,$(".level-3").each((t,a)=>{const o=$(a),i=parseInt(o.attr("rowspan"));if((s+=i)>e&&s<=l)o.toggleClass("collapsed");else if(s>l)return!1}),$(".body tr").each((t,s)=>{t<e||t>=l||(console.warn("rowIndex",t),$(s).children().each((e,t)=>{$(t).toggleClass("collapsed-row")}))})}(s,l)}),0===i.trim().length?$(".menu-about").hide():$(".menu-about").on("click",e=>{let t='<div class="title clearfix"><a class="close">X</a> <span>About This Map</span></div><div class="content"><div class="read">'+i+"</div></div>";T.html(t),$(".close",T).on("click",()=>{T.removeClass("open"),D.removeClass("open")}),D.addClass("open"),T.addClass("open")}),0===n.trim().length?$(".menu-submitStudy").hide():$(".menu-submitStudy").on("click",e=>{let t='<div class="title clearfix"><a class="close">X</a> <span>Submit a study</span></div><div class="content"><div class="read">'+n+"</div></div>";T.html(t),$(".close",T).on("click",()=>{T.removeClass("open"),D.removeClass("open")}),D.addClass("open"),T.addClass("open")});const X=$(".loader"),G=v.height()+200;v.resize(V),X.css({top:-G,bottom:G}),setTimeout(()=>{X.remove()},2e3)})})})});